{% extends "base.html" %}

{% block title %}Upload{% endblock %}

{% block extra_header %}
<link rel="stylesheet" href="{{ MEDIA_URL}}css/fileuploader.css" type="text/css" charset="utf-8"/>
{% endblock %}

{% block content %}
<div id="upload">       
    <noscript>          
        <p>Please enable JavaScript to use file uploader.</p>
    </noscript>         
</div>
<div id="dataset">
    <form id="dataset-form">
        <label for="dataset-name">Name:</label>
        <input id="dataset-name" type="text" name="name" maxlength="256">
        <input id="dataset-data-upload" type="hidden" name="data-upload" >
        <input id="dataset-submit" type="submit" value="Submit" />
    </form>
</div>
{% endblock %}

{% block extra_footer %}
<script type="text/javascript" src="{{ MEDIA_URL }}js/fileuploader.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/json2.js"></script>
<script type="text/javascript" src="redd.js"></script>
<script type="text/javascript">
$(function() {
    var uploader = new qq.FileUploader({
        action: "{% url ajax_upload %}",
        element: $("#upload")[0],
        multiple: false,
        onComplete: function(id, fileName, responseJSON) {
            if(responseJSON.success) {
                $("#dataset-data-upload").val(responseJSON["id"]);
                $("#dataset").show();
            } else {
                alert("Upload failed!");
            }
        },
        params: {
            "csrf_token": "{{ csrf_token }}",
            "csrf_name": "csrfmiddlewaretoken",
            "csrf_xname": "X-CSRFToken",
        }
    });

    $("#dataset-form").submit(function() {
        REDD.create_dataset(
            $("#dataset-form #dataset-name").val(),
            $("#dataset-form #dataset-data-upload").val(),
            function() {
                alert("Success!");
            });

        return false;
    }); 
})
</script>
{% endblock %}

